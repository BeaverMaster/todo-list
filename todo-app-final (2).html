<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App - Apple Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sf': ['-apple-system', 'BlinkMacSystemFont', 'SF Pro Display', 'Segoe UI', 'Roboto', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #c0c0c0;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
        }
        
        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .dark .glass {
            background: rgba(28, 28, 30, 0.7);
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(30px);
            }
        }
        .fade-out {
            animation: fadeOut 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="font-sf bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-black min-h-screen transition-colors duration-300">
    
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        
        <!-- Header -->
        <div class="glass rounded-3xl shadow-2xl p-4 sm:p-8 mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-800 dark:text-white mb-2">
                        üìù Aufgaben
                    </h1>
                    <p class="text-gray-600 dark:text-gray-400 text-xs sm:text-sm">
                        Verwalte deine Aufgaben ganz einfach
                    </p>
                </div>
                
                <!-- Dark Mode Toggle -->
                <div class="flex items-center gap-2 sm:gap-3 flex-shrink-0">
                    <span class="text-lg sm:text-xl md:text-2xl">‚òÄÔ∏è</span>
                    <label class="relative inline-block w-12 h-7 sm:w-14 sm:h-8 cursor-pointer flex-shrink-0">
                        <input 
                            type="checkbox" 
                            id="darkModeToggle"
                            class="sr-only"
                            onchange="toggleDarkMode()"
                        >
                        <div id="toggleBg" class="w-full h-full rounded-full bg-gray-300 transition-colors duration-300"></div>
                        <div id="toggleCircle" class="absolute left-0.5 top-0.5 sm:left-1 sm:top-1 bg-white w-6 h-6 sm:w-6 sm:h-6 rounded-full transition-transform duration-300 shadow-md"></div>
                    </label>
                    <span class="text-lg sm:text-xl md:text-2xl">üåô</span>
                </div>
            </div>
        </div>

        <!-- Add Todo Input -->
        <div class="glass rounded-3xl shadow-xl p-4 sm:p-6 mb-6">
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="text" 
                    id="todoInput" 
                    placeholder="Neue Aufgabe hinzuf√ºgen..."
                    class="flex-1 px-4 sm:px-5 py-3 sm:py-3.5 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl focus:outline-none focus:border-blue-500 dark:focus:border-blue-400 text-gray-800 dark:text-white placeholder-gray-400 transition-all duration-200 text-sm sm:text-base"
                >
                <button 
                    onclick="createTodo()"
                    class="px-6 sm:px-8 py-3 sm:py-3.5 bg-blue-500 hover:bg-blue-600 active:bg-blue-700 text-white font-semibold rounded-2xl transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 text-sm sm:text-base whitespace-nowrap"
                >
                    Hinzuf√ºgen
                </button>
            </div>
        </div>

        <!-- Filter Buttons -->
        <div class="glass rounded-3xl shadow-xl p-3 sm:p-4 mb-6">
            <div class="flex gap-2 justify-center flex-wrap">
                <button 
                    onclick="setFilter('all')" 
                    id="filterAll"
                    class="filter-btn px-4 sm:px-6 py-2 rounded-full font-medium transition-all duration-200 bg-blue-500 text-white text-sm sm:text-base"
                >
                    Alle
                </button>
                <button 
                    onclick="setFilter('active')" 
                    id="filterActive"
                    class="filter-btn px-4 sm:px-6 py-2 rounded-full font-medium transition-all duration-200 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm sm:text-base"
                >
                    Aktiv
                </button>
                <button 
                    onclick="setFilter('completed')" 
                    id="filterCompleted"
                    class="filter-btn px-4 sm:px-6 py-2 rounded-full font-medium transition-all duration-200 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 text-sm sm:text-base"
                >
                    Erledigt
                </button>
            </div>
        </div>

        <!-- Todo List -->
        <div class="glass rounded-3xl shadow-xl p-3 sm:p-6 mb-6">
            <div id="todoList" class="space-y-2 sm:space-y-3">
                <!-- Todos will be rendered here -->
            </div>
            
            <div id="emptyState" class="hidden text-center py-8 sm:py-12">
                <div class="text-5xl sm:text-6xl mb-4">üéâ</div>
                <p class="text-gray-500 dark:text-gray-400 text-base sm:text-lg">
                    Keine Aufgaben vorhanden
                </p>
                <p class="text-gray-400 dark:text-gray-500 text-xs sm:text-sm mt-2">
                    F√ºge eine neue Aufgabe hinzu, um loszulegen
                </p>
            </div>
        </div>

        <!-- Statistics -->
        <div class="glass rounded-3xl shadow-xl p-4 sm:p-6">
            <div class="grid grid-cols-3 gap-2 sm:gap-4 text-center">
                <div>
                    <div class="text-2xl sm:text-3xl font-bold text-blue-500 dark:text-blue-400" id="totalCount">0</div>
                    <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">Gesamt</div>
                </div>
                <div>
                    <div class="text-2xl sm:text-3xl font-bold text-green-500 dark:text-green-400" id="activeCount">0</div>
                    <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">Aktiv</div>
                </div>
                <div>
                    <div class="text-2xl sm:text-3xl font-bold text-purple-500 dark:text-purple-400" id="completedCount">0</div>
                    <div class="text-xs sm:text-sm text-gray-600 dark:text-gray-400 mt-1">Erledigt</div>
                </div>
            </div>
        </div>

    </div>

    <script>
        console.log('üöÄ Todo App gestartet');
        
        // State Management
        let todos = [];
        let currentFilter = 'all';
        let darkMode = false;
        let editingId = null;

        // Initialize App
        function init() {
            console.log('‚öôÔ∏è App wird initialisiert...');
            loadFromLocalStorage();
            applyDarkMode();
            renderTodos();
            setupEventListeners();
            console.log('‚úÖ App initialisiert');
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Enter key for todo input
            document.getElementById('todoInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    createTodo();
                }
            });
        }

        // LocalStorage Functions
        function loadFromLocalStorage() {
            const data = localStorage.getItem('appleTodos');
            if (data) {
                const parsed = JSON.parse(data);
                todos = parsed.todos || [];
                darkMode = parsed.darkMode || false;
                console.log('üì¶ Daten geladen:', { todos: todos.length, darkMode });
            }
        }

        function saveToLocalStorage() {
            const data = {
                todos: todos,
                darkMode: darkMode
            };
            localStorage.setItem('appleTodos', JSON.stringify(data));
            console.log('üíæ Daten gespeichert');
        }

        // Dark Mode Functions
        function toggleDarkMode() {
            darkMode = !darkMode;
            console.log('üåì Dark Mode:', darkMode ? 'AN' : 'AUS');
            applyDarkMode();
            saveToLocalStorage();
        }

        function applyDarkMode() {
            const toggle = document.getElementById('darkModeToggle');
            const toggleBg = document.getElementById('toggleBg');
            const toggleCircle = document.getElementById('toggleCircle');
            
            // Calculate translation based on screen width
            const isMobile = window.innerWidth < 640; // sm breakpoint
            const translateDistance = isMobile ? '20px' : '24px';
            
            if (darkMode) {
                document.documentElement.classList.add('dark');
                toggle.checked = true;
                toggleBg.classList.remove('bg-gray-300');
                toggleBg.classList.add('bg-blue-500');
                toggleCircle.style.transform = `translateX(${translateDistance})`;
            } else {
                document.documentElement.classList.remove('dark');
                toggle.checked = false;
                toggleBg.classList.remove('bg-blue-500');
                toggleBg.classList.add('bg-gray-300');
                toggleCircle.style.transform = 'translateX(0)';
            }
        }

        // CRUD Operations

        // CREATE
        function createTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (text === '') {
                input.focus();
                return;
            }

            const todo = {
                id: Date.now(),
                text: text,
                completed: false,
                priority: 'none', // none, medium, high
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };

            todos.unshift(todo);
            saveToLocalStorage();
            input.value = '';
            renderTodos();
            
            console.log('‚úÖ Todo erstellt:', todo.text);
        }

        // READ (filter)
        function getFilteredTodos() {
            if (currentFilter === 'active') {
                return todos.filter(t => !t.completed);
            } else if (currentFilter === 'completed') {
                return todos.filter(t => t.completed);
            }
            return todos;
        }

        // UPDATE (toggle completed)
        function toggleTodo(id) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                todo.completed = !todo.completed;
                todo.updatedAt = new Date().toISOString();
                saveToLocalStorage();
                renderTodos();
                console.log('‚úì Todo Status ge√§ndert:', todo.text, 'Erledigt:', todo.completed);
            }
        }

        // UPDATE (priority)
        function setPriority(id, priority) {
            const todo = todos.find(t => t.id === id);
            if (todo) {
                // Toggle priority: if same priority clicked, remove it
                if (todo.priority === priority) {
                    todo.priority = 'none';
                } else {
                    todo.priority = priority;
                }
                todo.updatedAt = new Date().toISOString();
                saveToLocalStorage();
                renderTodos();
                console.log('üéØ Priorit√§t ge√§ndert:', todo.text, 'Priorit√§t:', todo.priority);
            }
        }

        // UPDATE (edit text)
        function enableEdit(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo || todo.completed) return;

            editingId = id;
            console.log('‚úèÔ∏è Bearbeiten gestartet:', todo.text);
            
            const todoElement = document.querySelector(`[data-id="${id}"]`);
            const textSpan = todoElement.querySelector('.todo-text');
            
            const input = document.createElement('input');
            input.type = 'text';
            input.value = todo.text;
            input.className = 'flex-1 px-3 py-2 bg-white dark:bg-gray-700 border-2 border-blue-500 rounded-xl focus:outline-none text-gray-800 dark:text-white';
            
            const saveEdit = () => {
                const newText = input.value.trim();
                if (newText && newText !== todo.text) {
                    todo.text = newText;
                    todo.updatedAt = new Date().toISOString();
                    saveToLocalStorage();
                    console.log('üíæ Todo aktualisiert:', newText);
                }
                editingId = null;
                renderTodos();
            };

            input.onblur = saveEdit;
            input.onkeydown = (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                } else if (e.key === 'Escape') {
                    editingId = null;
                    renderTodos();
                }
            };

            textSpan.replaceWith(input);
            input.focus();
            input.select();
        }

        // DELETE
        function deleteTodo(id) {
            const todo = todos.find(t => t.id === id);
            console.log('üóëÔ∏è L√∂sche Todo:', todo ? todo.text : id);
            
            const index = todos.findIndex(t => t.id === id);
            if (index > -1) {
                // Animation
                const element = document.querySelector(`[data-id="${id}"]`);
                if (element) {
                    element.classList.add('fade-out');
                    setTimeout(() => {
                        todos.splice(index, 1);
                        saveToLocalStorage();
                        renderTodos();
                        console.log('‚úÖ Todo gel√∂scht');
                    }, 300);
                } else {
                    todos.splice(index, 1);
                    saveToLocalStorage();
                    renderTodos();
                }
            }
        }

        // Filter Functions
        function setFilter(filter) {
            currentFilter = filter;
            console.log('üîç Filter gewechselt:', filter);
            
            // Update button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            });
            
            const activeBtn = document.getElementById(`filter${filter.charAt(0).toUpperCase() + filter.slice(1)}`);
            activeBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
            activeBtn.classList.add('bg-blue-500', 'text-white');
            
            renderTodos();
        }

        // Render Functions
        function renderTodos() {
            const filteredTodos = getFilteredTodos();
            const todoList = document.getElementById('todoList');
            const emptyState = document.getElementById('emptyState');

            if (filteredTodos.length === 0) {
                todoList.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                todoList.innerHTML = filteredTodos.map(todo => {
                    // Determine background color based on priority and completion
                    let bgClass = '';
                    let borderClass = '';
                    
                    if (todo.completed) {
                        bgClass = 'bg-green-50 dark:bg-green-900/20';
                        borderClass = 'border-2 border-green-300 dark:border-green-700';
                    } else if (todo.priority === 'high') {
                        bgClass = 'bg-red-50 dark:bg-red-900/20';
                        borderClass = 'border-2 border-red-300 dark:border-red-700';
                    } else if (todo.priority === 'medium') {
                        bgClass = 'bg-yellow-50 dark:bg-yellow-900/20';
                        borderClass = 'border-2 border-yellow-300 dark:border-yellow-700';
                    } else {
                        bgClass = 'bg-white dark:bg-gray-800';
                        borderClass = '';
                    }
                    
                    return `
                    <div class="slide-in flex items-center gap-2 sm:gap-3 p-3 sm:p-4 rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 ${bgClass} ${borderClass}" data-id="${todo.id}">
                        
                        <!-- Checkbox -->
                        <input 
                            type="checkbox" 
                            ${todo.completed ? 'checked' : ''}
                            onclick="toggleTodo(${todo.id})"
                            class="w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0 rounded-full border-2 border-gray-300 dark:border-gray-600 checked:bg-blue-500 checked:border-blue-500 cursor-pointer transition-all duration-200"
                        >
                        
                        <!-- Text -->
                        <div class="flex items-center gap-2 flex-1 min-w-0">
                            <span 
                                ondblclick="enableEdit(${todo.id})"
                                class="todo-text text-sm sm:text-base text-gray-800 dark:text-white ${todo.completed ? 'text-gray-400 dark:text-gray-500' : ''} cursor-text break-words"
                            >
                                ${escapeHtml(todo.text)}
                            </span>
                            ${todo.completed ? '<span class="text-green-500 text-lg flex-shrink-0">‚úì</span>' : ''}
                        </div>
                        
                        <!-- Priority Checkboxes -->
                        ${!todo.completed ? `
                        <div class="flex gap-1.5 sm:gap-2 items-center flex-shrink-0">
                            <label class="flex items-center gap-0.5 sm:gap-1 cursor-pointer group" title="Gelb - Mittlere Priorit√§t">
                                <input 
                                    type="checkbox" 
                                    ${todo.priority === 'medium' ? 'checked' : ''}
                                    onclick="setPriority(${todo.id}, 'medium')"
                                    class="w-4 h-4 sm:w-5 sm:h-5 rounded border-2 border-yellow-400 checked:bg-yellow-400 checked:border-yellow-400 cursor-pointer transition-all duration-200"
                                >
                                <span class="hidden sm:inline text-xs text-gray-600 dark:text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">‚ö†Ô∏è</span>
                            </label>
                            <label class="flex items-center gap-0.5 sm:gap-1 cursor-pointer group" title="Rot - Hohe Priorit√§t">
                                <input 
                                    type="checkbox" 
                                    ${todo.priority === 'high' ? 'checked' : ''}
                                    onclick="setPriority(${todo.id}, 'high')"
                                    class="w-4 h-4 sm:w-5 sm:h-5 rounded border-2 border-red-400 checked:bg-red-400 checked:border-red-400 cursor-pointer transition-all duration-200"
                                >
                                <span class="hidden sm:inline text-xs text-gray-600 dark:text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">üî¥</span>
                            </label>
                        </div>
                        ` : ''}
                        
                        <!-- Action Buttons -->
                        <div class="flex gap-1 sm:gap-2 flex-shrink-0">
                            ${!todo.completed ? `
                                <button 
                                    onclick="enableEdit(${todo.id})"
                                    class="p-1.5 sm:p-2 text-base sm:text-lg text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-all duration-200"
                                    title="Bearbeiten"
                                >
                                    ‚úèÔ∏è
                                </button>
                            ` : ''}
                            <button 
                                onclick="deleteTodo(${todo.id})"
                                class="p-1.5 sm:p-2 text-base sm:text-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-all duration-200"
                                title="L√∂schen"
                            >
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                    `;
                }).join('');
            }

            updateStats();
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = todos.length;
            document.getElementById('activeCount').textContent = todos.filter(t => !t.completed).length;
            document.getElementById('completedCount').textContent = todos.filter(t => t.completed).length;
        }

        // Helper function to escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Initialize on load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>

</body>
</html>